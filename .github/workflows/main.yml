name: Ubuntu RDP (Xfce)

on:
  workflow_dispatch:

jobs:
  ubuntu-rdp:
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: Sistem G√ºncelle
        run: |
          sudo apt-get update
          sudo apt-get upgrade -y

      - name: Xfce Masa√ºst√º Kur
        run: |
          # Xfce (hafif masa√ºst√º) kur
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y xfce4 xfce4-goodies
          
          # Ek ara√ßlar
          sudo apt-get install -y firefox xterm nano

      - name: RDP Sunucusu Kur (xrdp)
        run: |
          # xrdp kur
          sudo apt-get install -y xrdp
          
          # xrdp servisini ba≈ülat
          sudo systemctl enable xrdp
          sudo systemctl start xrdp
          
          # Port a√ß (3389)
          sudo ufw allow 3389/tcp
          sudo ufw --force enable

      - name: Xrdp Ayarlarƒ±nƒ± D√ºzelt
        run: |
          # Xrdp i√ßin Xfce oturumu ayarla
          echo "xfce4-session" > ~/.xsession
          sudo chmod +x ~/.xsession
          
          # Xrdp config d√ºzenle
          sudo sed -i 's/use_vsock=true/use_vsock=false/g' /etc/xrdp/xrdp.ini
          echo "exec startxfce4" | sudo tee -a /etc/xrdp/startwm.sh

      - name: Kullanƒ±cƒ± ve ≈ûifre Ayarla
        run: |
          # Varsayƒ±lan ubuntu kullanƒ±cƒ±sƒ±nƒ±n ≈üifresini deƒüi≈ütir
          echo "ubuntu:ubuntu123" | sudo chpasswd
          
          # Veya yeni kullanƒ±cƒ± olu≈ütur
          sudo useradd -m -s /bin/bash ghuser
          echo "ghuser:github123" | sudo chpasswd
          sudo usermod -aG sudo ghuser
          
          echo "USER1=ubuntu" >> $env:GITHUB_ENV
          echo "PASS1=ubuntu123" >> $env:GITHUB_ENV
          echo "USER2=ghuser" >> $env:GITHUB_ENV
          echo "PASS2=github123" >> $env:GITHUB_ENV

      - name: NoMachine Kur (Alternatif - Daha ƒ∞yi)
        run: |
          # NoMachine indir ve kur
          wget https://download.nomachine.com/download/8.10/Linux/nomachine_8.10.1_1_amd64.deb
          sudo dpkg -i nomachine_*.deb || sudo apt-get install -f -y
          
          # NoMachine servisini ba≈ülat
          sudo systemctl start nxserver
          
          echo "NOMACHINE_INSTALLED=true" >> $env:GITHUB_ENV

      - name: IP ve Baƒülantƒ± Bilgilerini Al
        run: |
          # IP adreslerini al
          PRIVATE_IP=$(hostname -I | awk '{print $1}')
          PUBLIC_IP=$(curl -s ifconfig.me)
          
          echo "PRIVATE_IP=$PRIVATE_IP" >> $env:GITHUB_ENV
          echo "PUBLIC_IP=$PUBLIC_IP" >> $env:GITHUB_ENV
          
          # Baƒülantƒ± portlarƒ±nƒ± g√∂ster
          echo "RDP_PORT=3389" >> $env:GITHUB_ENV
          echo "NOMACHINE_PORT=4000" >> $env:GITHUB_ENV

      - name: Display Ba≈ülat
        run: |
          # Display manager ba≈ülat
          sudo systemctl start lightdm || true
          
          # X server ba≈ülat
          startxfce4 &
          sleep 5

      - name: Baƒülantƒ± Bilgilerini G√∂ster
        run: |
          echo " "
          echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
          echo "‚ïë            UBUNTU RDP BAƒûLANTI Bƒ∞LGƒ∞LERƒ∞        ‚ïë"
          echo "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
          echo "‚ïë üåç Public IP: ${{ env.PUBLIC_IP }}"
          echo "‚ïë üè† Private IP: ${{ env.PRIVATE_IP }}"
          echo "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
          echo "‚ïë üìå SE√áENEK 1: XRDP (Windows RDP ile)"
          echo "‚ïë   ‚Ä¢ Port: 3389"
          echo "‚ïë   ‚Ä¢ Kullanƒ±cƒ±: ubuntu"
          echo "‚ïë   ‚Ä¢ ≈ûifre: ubuntu123"
          echo "‚ïë "
          echo "‚ïë üìå SE√áENEK 2: NoMachine (Daha Hƒ±zlƒ±)"
          echo "‚ïë   ‚Ä¢ Port: 4000"
          echo "‚ïë   ‚Ä¢ Kullanƒ±cƒ±: ghuser"
          echo "‚ïë   ‚Ä¢ ≈ûifre: github123"
          echo "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
          echo "‚ïë üõ†Ô∏è  Komutlar:"
          echo "‚ïë   ‚Ä¢ Firefox a√ß: firefox"
          echo "‚ïë   ‚Ä¢ Terminal: ctrl+alt+t"
          echo "‚ïë   ‚Ä¢ √áƒ±kƒ±≈ü: exit"
          echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
          echo " "
          echo "‚ö†Ô∏è  Dƒ∞KKAT: Runner 60 dakika sonra otomatik kapanƒ±r!"
          echo "‚ö†Ô∏è  ƒ∞≈üin bitince workflow'u DURDUR!"

      - name: Baƒülantƒ±yƒ± Aktif Tut
        run: |
          # Baƒülantƒ±larƒ± dinle
          echo "Baƒülantƒ± portlarƒ± dinleniyor..."
          echo "‚Ä¢ RDP (3389) hazƒ±r"
          echo "‚Ä¢ NoMachine (4000) hazƒ±r"
          echo ""
          echo "Baƒülanmak i√ßin:"
          echo "1. Windows: Remote Desktop -> ${{ env.PUBLIC_IP }}"
          echo "2. veya NoMachine indir -> ${{ env.PUBLIC_IP }}:4000"
          echo ""
          
          # 55 dakika bekle (max 60)
          sleep 3300
          echo "‚è∞ Zaman doluyor, 5 dakika kaldƒ±..."
